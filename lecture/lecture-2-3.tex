%-*- coding:utf-8 -*-

\documentclass[dvipdfmx]{beamer}
\usepackage{tutorial}

\title{計算機実験II (L3) --- 転送行列・分子動力学}
\date{2018/11/30}

\begin{document}

\begin{frame}
  \titlepage
  \tableofcontents
\end{frame}

\section{多体系の統計力学}

\input{6_monte_carlo/statphys-01.tex}
\input{6_monte_carlo/statphys-02.tex}
\input{6_monte_carlo/statphys-03.tex}
\input{6_monte_carlo/statphys-05.tex}

\section{数え上げ}

\input{6_monte_carlo/counting-01.tex}
\input{6_monte_carlo/counting-02.tex}

\section{転送行列法}

\input{6_monte_carlo/transfer-01.tex}
\input{6_monte_carlo/transfer-02.tex}
\input{6_monte_carlo/transfer-03.tex}
\input{6_monte_carlo/transfer-04.tex}

\input{1_basics/lapack-10.tex}
\input{1_basics/lapack-11.tex}
\input{4_eigenvalue_problem/dense-07.tex}

\input{6_monte_carlo/transfer-05.tex}
\input{6_monte_carlo/transfer-06.tex}

\section{分子動力学法}

\begin{frame}[t,fragile]{古典多粒子系}
  \begin{itemize}
    \setlength{\itemsep}{1em}
  \item ハミルトニアン
    \[
    H = \sum \frac{p_i^2}{2m} + \sum_{ij} V(x_i, x_j)
    \]
  \item 分配関数
    \[
    Z(T) = \int \exp [- \beta H(p,x) ] \, dp \, dx
    \]
    \begin{itemize}
    \item 運動量$p$に関する積分は簡単に実行できる(ガウス積分)
    \item 位置$x$に関する積分: 数値積分、マルコフ連鎖モンテカルロ法、分子動力学法
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{数値積分}
  \begin{itemize}
    \setlength{\itemsep}{1em}
  \item 一次元の場合
    \begin{itemize}
    \item 台形公式: 積分区間$(a,b)$を$M$個の幅$\Delta=(b-a)/M$の区間に分けて線形関数で近似
      \begin{align*}
        \int_a^b f(x) \, dx &= \sum_{i=1}^M \int_{a+\Delta (i-1)}^{a+\Delta i} f(x) \, dx \\
        &\simeq \sum_{i=1}^M \Delta \frac{f({a+\Delta (i-1)}) + f({a+\Delta i})}{2}
      \end{align*}
    \item より高次の公式: シンプソンの公式(区間を二次式で近似)など
    \end{itemize}
    \item 高次元になると区間の数が指数関数的に増える (次元の呪い)
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{マルコフ連鎖モンテカルロ法}
  \begin{itemize}
    \setlength{\itemsep}{1em}
  \item メトロポリス法
    \begin{itemize}
    \item 一つの粒子を選ぶ(位置$x$)
    \item 新しい位置の候補をある確率分布に従って選ぶ($x'$)
    \item ポテンシャルエネルギーの変化量($\Delta E$)を計算し、確率$P=\min(1,exp[-\beta\Delta E])$で新しい位置を採択
    \end{itemize}
  \item 新しい位置の選び方
    \begin{itemize}
    \item 大きく変えすぎると棄却率が増加
    \item もとの位置を中心とする局所的な分布
    \item $\sigma={\cal O}(1)$の標準偏差をもつ正規分布など: $N(x, \sigma^2)$
    \end{itemize}
  \end{itemize}
\end{frame}

%% \begin{frame}[t,fragile]{Box-Muller法}
%%   \begin{itemize}
%%     \setlength{\itemsep}{1em}
%%   \item 一様分布乱数から正規分布乱数を生成する方法
%%     \begin{itemize}
%%     \item 2次元の(標準)ガウス分布を考える
%%       \[
%%       f(x,y)\,dx\,dy= \frac{1}{2\pi} e^{-(x^2+y^2)/2} \,dx\,dy
%%       \]
%%     \item 極座標$(r,\theta)$に変換 ($x=r\cos\theta$, $y=r\sin\theta$)
%%       \[
%%       \frac{1}{2\pi} e^{-(x^2+y^2)/2} \,dx\,dy = \frac{1}{2\pi} r \, e^{-r^2/2} \,dr\,d\theta
%%       \]
%%     \item $\theta$は$(0,2\pi)$の一様分布
%%     \item $r$は$f(r) = r \, e^{-r^2/2}$に従う
%%       \begin{align*}
%%         F(r) = \int_0^r f(r) \, dr = 1 - e^{-r^2/2}, \qquad F^{-1}(q) = \sqrt{- 2 \log(1-q)}
%%       \end{align*}
%%     \item 二つの一様乱数から二つの独立な正規分布乱数が生成される
%%     \end{itemize}
%%   \end{itemize}
%% \end{frame}

\begin{frame}[t,fragile]{分子動力学法}
  \begin{itemize}
    \setlength{\itemsep}{1em}
  \item 適当な初期条件から、運動方程式に従って位置と運動量を時間発展させる
    \begin{itemize}
    \item Euler法、Runge-Kutta法など
    \item $6N$次元の連立微分方程式
    \end{itemize}
  \item 時間発展に関する物理量の時間平均から平均を評価
    \begin{align*}
      \langle A(p,x) \rangle &= \frac{1}{Z(E)} \int A(p,x) \, \delta(H(p,x)-E) \, dp \, dx \\
      &\simeq \frac{1}{t_{\rm max}} \int_0^{t_{\rm max}} A(p(t),x(t)) \, dt
    \end{align*}
    \begin{itemize}
    \item 運動方程式では全エネルギーが保存する→ミクロカノニカル分布
    \end{itemize}
  \end{itemize}
\end{frame}

\input{2_ode/ode-03.tex}
\input{2_ode/ode-06.tex}
\input{2_ode/ode-07.tex}
\input{2_ode/ode-08.tex}
\input{2_ode/symplectic-05.tex}

\begin{frame}[t,fragile]{Nose-Hoover熱浴}
  \begin{itemize}
    %\setlength{\itemsep}{1em}
  \item カノニカル分布の実現
    \begin{itemize}
    \item 巨大な環境(熱浴)を付ける必要がある？
    \end{itemize}
  \item Nose (能勢)-Hoover法
    \begin{itemize}
    \item 熱浴をたった1つの自由度($s$)だけで実現する!
    \item 現実系のハミルトニアン
      \begin{align*}
        H(\mathbf{p},\mathbf{x}) &= \sum_i \frac{p_i^2}{2m} + U(\mathbf{x})
      \end{align*}
    \item 仮想系のハミルトニアン (温度$T$をパラメータとして含む)
      \begin{align*}
        H'(\mathbf{p}',\mathbf{x}',{\color{red}p_s},{\color{red}s}) &= \sum_i \frac{{p'_i}^2}{2m{\color{red}s^2}} + U(\mathbf{x}') + {\color{red}\frac{p_s^2}{2Q} + g k_B T\log s}
      \end{align*}
      $s$: 熱浴の自由度、$p_s$: $s$に共役な運動量、$Q$: 熱浴の「質量」、$g$: 系の自由度($3N+1$または$3N$)
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{Nose-Hoover熱浴}
  \begin{itemize}
  \item 仮想系の運動方程式
    \begin{align*}
      \frac{dx_i'}{dt'} &= \frac{\partial H'}{\partial p_i'} = \frac{p_i'}{ms^2} \\
      \frac{dp_i'}{dt'} &= -\frac{\partial H'}{\partial x_i'} = -\frac{\partial U}{\partial x_i'} \\
      \frac{ds}{dt'} &= \frac{\partial H'}{\partial p_s} = \frac{p_s}{Q} \\
      \frac{dp_s}{dt'} &= -\frac{\partial H'}{\partial s} = \sum_i \frac{{p'_i}^2}{ms^3} - \frac{g k_B T}{s}
    \end{align*}
  \item 現実系と仮想系との間に以下の関係を仮定する

    $x_i=x_i'$、$p_i=p_i'/{\color{red}s}$、$t=\int^t s^{-1} dt'$、$dt=dt'/{\color{red}s}$
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{Nose-Hoover熱浴}
  \begin{itemize}
    %\setlength{\itemsep}{1em}
  \item 現実系の変数による書き換え
    \begin{align*}
      \frac{dx_i}{dt} &= \frac{\partial H}{\partial p_i} \\
      \frac{dp_i}{dt} &= -\frac{\partial U}{\partial x_i} -\frac{p_s}{Q} p_i \\
      \frac{dp_s}{dt} &= 2 \big[ \sum_i \frac{{p_i}^2}{2m} - \frac{g k_B T}{2} \big]
    \end{align*}
  \item あるいは、$x_s = \log x$を導入すると、最後の2つの式は
    \begin{align*}
      % \frac{dx_i}{dt} &= \frac{\partial H}{\partial p_i} \\
      \frac{dp_i}{dt} &= -\frac{\partial U}{\partial x_i} -\frac{dx_s}{dt} p_i \\
      \frac{d^2x_s}{dt^2} &= \frac{2}{Q} \big[ \sum_i \frac{{p_i}^2}{2m} - \frac{g k_B T}{2} \big]
    \end{align*}
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{カノニカル分布の実現}
  \begin{itemize}
    %\setlength{\itemsep}{1em}
  \item $H'(\mathbf{p}',\mathbf{x}',p_s,s)$による仮想時間発展によりエネルギー$E'$のミクロカノニカルアンサンブルが実現しているとする

    $\Leftrightarrow$ 仮想時間$t'$でサンプルすると$2(3N+1)$次元の位相空間上で$H'=E$の曲面上に均等に分布(エルゴード性)
    
    $\Leftrightarrow$ 分布関数: $\delta [ H'(\mathbf{p}',\mathbf{x}',p_s,s) - E']$
    
    $\Rightarrow$ 現実系の変数$(p,q)$に関する周辺分布を考える
  \item 仮想系のミクロカノニカル分配関数
    \begin{align*}
      Z'&=\int d\mathbf{p}' d\mathbf{x}' dp_s ds \, \delta [ H'(\mathbf{p}',\mathbf{x}',p_s,s) - E'] \\
      &=\int d\mathbf{{\color{red}p}} d\mathbf{{\color{red}x}} dp_s ds \, {\color{red}s^{3N}} \delta [ {\color{red}H(\mathbf{p},\mathbf{x})} + \frac{p_s^2}{2Q} + g k_B T \log s - E']
    \end{align*}
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{カノニカル分布の実現}
  \begin{itemize}
    %\setlength{\itemsep}{1em}
  \item $s$について積分(*)
    \begin{align*}
      \int ds \, s^{3N} \delta[f(s)] = s_0^{3N} / | f'(s_0) | = s_0^{3N+1} / g k_B T
    \end{align*}
    $f(s) \equiv H(\mathbf{p},\mathbf{x}) + \frac{p_s^2}{2Q} + g k_B T \log s - E'$、$s_0$は$f(s)=0$の解
    \begin{align*}
      s_0 = \exp \Big[ -\frac{1}{gk_BT} \Big( H(p,x) + \frac{p_s^2}{2Q} - E' \Big) \Big]
    \end{align*}
  \item さらに$p_s$についてガウス積分を行い、$g=3N+1$とすると
    \begin{align*}
      Z' = \frac{1}{3N+1} \sqrt{\frac{2Q\pi}{k_BT}} e^{E'/k_BT} \int d\mathbf{p}d\mathbf{x} \, {\color{red}\exp [- H(p,x)/k_BT ]}
    \end{align*}
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{補足(*)}
  \begin{itemize}
    %\setlength{\itemsep}{1em}
  \item $f(s)=0$の解を$s_0$とすると、$\displaystyle \delta [f(s)] = \frac{\delta(s-s_0)}{|f'(s_0)|}$が成り立つ

    証明: $u=f(s)$とおくと、$du = f'(s)ds$から
    \begin{align*}
      \int h(s) {\color{red}\delta [f(s)]} \, ds= \int h(f^{-1}(u)) \delta(u) \frac{du}{|f'(f^{-1}(u))|}
    \end{align*}
    $f^{-1}(0)=s_0$なので
    \begin{align*}
      = \frac{h(s_0)}{|f'(s_0)|} = \int h(s) {\color{red}\frac{\delta(s-s_0)}{|f'(s_0)|}} ds
    \end{align*}
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{実時間発展の場合}
  \begin{itemize}
    %\setlength{\itemsep}{1em}
  \item 実時間に直した方程式の時間発展を計算した場合、物理量$A(\mathbf{p},\mathbf{x})$の実時間平均は
    \begin{align*}
      \langle A \rangle_t &= \lim_{\tau\rightarrow\infty} \frac{1}{\tau} \int_0^\tau dt \, A(\mathbf{p}(t),\mathbf{x}(t)) \\
      &= \lim_{\tau\rightarrow\infty} \frac{\tau'}{\tau} \frac{1}{\tau'} \int_0^{\tau'} dt' \, A(\mathbf{p}'(t')/s(t'),\mathbf{x}'(t')) / s(t')
    \end{align*}
  \item $\tau = \int_0^{\tau} dt = \int_0^{\tau'} dt'/s(t')$なので
    \begin{align*}
      \langle A \rangle_t &= \frac{\lim_{\tau'\rightarrow\infty} \frac{1}{\tau'} \int_0^{\tau'} dt' \, A(\mathbf{p}'(t')/s(t'),\mathbf{x}'(t')) / s(t')}{\lim_{\tau'\rightarrow\infty} \frac{1}{\tau'} \int_0^{\tau'} dt' \, 1/ s(t')} \\
      &= \langle A(\mathbf{p},\mathbf{x}) / s \rangle_{t'} / \langle 1 / s \rangle_{t'}
    \end{align*}
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{実時間発展の場合}
  \begin{itemize}
    %\setlength{\itemsep}{1em}
  \item 分子・分母の$t'$に関する期待値を計算すると、$s_0$が1つキャンセルするので
    \begin{align*}
      \langle A \rangle_t &= \frac{\int d\mathbf{p} d\mathbf{x} \, A(\mathbf{p},\mathbf{x}) \exp [ -\frac{3N}{gk_BT} H(\mathbf{p}, \mathbf{x})]}{\int d\mathbf{p} d\mathbf{x} \, \exp [ -\frac{3N}{gk_BT} H(\mathbf{p}, \mathbf{x})]}
    \end{align*}
    \item {\color{red}$g=3N$}とすると、実時間発展の長時間平均とカノニカル分布における位相平均が一致
  \end{itemize}
\end{frame}

\begin{frame}[t,fragile]{Nose-Hoover熱浴}
  \begin{itemize}
    %\setlength{\itemsep}{1em}
  \item 熱浴をたった1つの自由度($s$)だけで実現する!
  \item 運動方程式(実時間発展の場合)
    \begin{align*}
      \frac{dx_i}{dt} &= \frac{\partial H}{\partial p_i} \\
      \frac{dp_i}{dt} &= -\frac{\partial U}{\partial x_i} -\frac{p_s}{Q} p_i \\
      \frac{dp_s}{dt} &= 2 \big[ \sum_i \frac{{p_i}^2}{2m} - \frac{g k_B T}{2} \big]
    \end{align*}
  \item $\sum \frac{p_i^2}{2m}$: 現実系の全運動エネルギー
  \item 「摩擦係数」$p_s$にネガティブフィードバックがかかる
  \item $g=3N$ととれば、$(\mathbf{p},\mathbf{q})$の周辺分布はカノニカル分布になる
  \end{itemize}
\end{frame}

\end{document}
