%-*- coding:utf-8 -*-

\documentclass{jarticle}

\usepackage{amsmath}
\usepackage{graphics}
\usepackage{hyperref}

\setlength{\oddsidemargin}{-0.7cm}
\setlength{\topmargin}{-1.5cm}
\setlength{\textwidth}{16.5cm}
\setlength{\textheight}{26cm}
\pagestyle{empty}

\begin{document}

\noindent
{\bf\large 「計算機実験II」実習課題(EX3) 2018-12-07}
\\[-0.5em]

\noindent
\begin{itemize}
\item 講義のページ: \verb+http://exa.phys.s.u-tokyo.ac.jp/ja/lectures/2018w-computer2+

\item サンプルプログラム: 「実習EX3サンプルプログラム」{\tt example-2-L3.zip}

\item 準備練習

%\begin{enumerate}
%\item Box-Muller法を用いて、正規分布乱数を生成してみよ。ヒストグラムを作り、正しく正規分布となっていることを確認せよ
%\end{enumerate}

\begin{enumerate}
\item 復習(計算機実験I L2, EX2): 調和ポテンシャル$V(x)=x^2/2$中の1粒子の運動方程式を、4次のRunge-Kutta法で解け。初期値は適当に設定してよい。十分時間刻み幅を小さくすると、位相空間上で軌道が閉じ、厳密解と一致することを確認せよ
\item 上のプログラムを非調和ポテンシャル$V(x)=-x^2/2+x^4/4$の場合に拡張せよ
\end{enumerate}

\item 基本課題
  \begin{enumerate}
  \item {\tt example-2-L3/exact\_counting.c}は、スピン配位をすべて数え上げることにより、二次元正方格子イジング模型の分配関数を計算するプログラムである。温度{\tt temperature}を低くしたり、システムサイズ{\tt L}を大きくすると、桁あふれにより答えが{\tt inf}となってしまう。そのような場合でも正しく計算が行えるよう、プログラムを修正せよ(参考: 講義資料 {\tt lecture-2-3.pdf} p.7)
  \item {\tt example-2-L3/transfer\_matrix.c}は、転送行列${\bf T}$から${\rm tr}\ {\bf T}^L$を計算することで$L \times M$正方格子イジング模型の自由エネルギーを計算するプログラムである。内部では、$2^M$次元のベクトル${\bf v}$に対角行列$D^{1/2}$を掛ける関数{\tt product\_D}、${\bf v}$に疎行列$U$を掛ける関数{\tt product\_U}、それらを組み合わせて$2^M$次元のベクトル${\bf v}$に転送行列${\bf T}$を掛ける関数{\tt product\_T}を使っている。講義資料 {\tt lecture-2-3.pdf} p.10で定義された転送行列を掛ける操作となっていることを確認せよ\footnote{桁あふれを防ぐために、それぞれのボンドのボルツマン重みがあらかじめ$\exp(1/T)$ ($T$は温度)で割ってあることに注意}

\item {\tt example-2-L3/transfer\_matrix.c}では、最初に転送行列${\bf T}$を作り、行列・行列積により${\bf T}^L$を計算しているが、行列を陽に生成せずに$2^M$個の基底ベクトルにそれぞれ${\bf T}$を$L$回掛けて、それぞれの対応する成分を足し合わせる方法で転送行列を計算するようにプログラムを変更せよ。システムサイズを増やしていった時の計算時間やメモリ使用量の増加はどのように改善されるか? (参考: 講義資料 {\tt lecture-2-3.pdf} p.11)\footnote{実行中のメモリ使用量は{\tt top}コマンドでモニタすることができる}
\item {\tt example-2-L3/transfer\_matrix.c}内の関数{\tt product\_T}とべき乗法を用いて、転送行列${\bf T}$の最大固有値を求め、長さ$L$が無限の系の自由エネルギー密度を計算せよ(参考: 講義資料 {\tt lecture-1-4.pdf} p.4)。なお、温度$T=2$、幅$M=4$の時の自由エネルギー密度の厳密な値は、-2.0757223592$\cdots$である
\item Nose-Hoover熱浴を用いた分子動力学法により、調和ポテンシャルあるいは非調和ポテンシャル中の1粒子のカノニカル分布を調べる。講義L3では、熱浴を1つの自由度($s$)で実現する方法を説明したが、調和振動子のような場合には、そのような単純な熱浴ではエルゴード性が破れてしまうことがわかっている。この問題を解決する方法の1つとしてNose-Hoover chain法がある。この方法では、熱浴にもう一つの自由度($r$とそれに共役な運動量$p_r$)を追加した運動方程式
  \begin{align*}
    \frac{dx}{dt} &= \frac{p}{m} \\
    \frac{dp}{dt} &= -\frac{\partial V}{\partial x} - \frac{p_s}{Q} p \\
    \frac{dp_s}{dt} &= \frac{p^2}{m} - k_B T - \frac{p_r}{Q} p_s \\
    \frac{dp_r}{dt} &= \frac{p_s^2}{Q} - k_B T
  \end{align*}
  を解くことで、現実系のカノニカル分布を実現する\footnote{熱浴$s$の温度をさらにもうひとつの熱浴$r$で制御している}。$m=1$, $Q=1$, $k_BT=1$として、4次のRunge-Kutta法で運動方程式を解き、その位相空間上での軌道を確認せよ(時間刻み$\Delta=0.01$で$t=10^4$程度まで計算せよ)。また、座標$x$と運動量$p$のヒストグラムを作成し、カノニカル分布となっているかどうか確認せよ
  \end{enumerate}
\item 応用課題
  \begin{enumerate}
  %% \item BLASの{\tt dgemm}関数の実装には「キャッシュブロッキング」という手法が使われている。この手法について調べ、自分で行列・行列積を実装してみよ
  \item BLASには行列・ベクトル積を計算する{\tt dgemv}関数が用意されている。{\tt dgemv}の仕様(引数の渡し方)を調べ、行列・ベクトル積のテストプログラムを作成せよ。明示的なfor文により行列・ベクトル積を計算するテストプログラムも作成し、両者の速度やサイズ依存性を比較せよ。行列・行列積({\tt dgemm})の場合とどのような違いが見られるか? またその違いの理由を考察せよ
  \item 数え上げあるいは転送行列により計算されたイジング模型の分配関数を温度に関して数値微分することで、内部エネルギー、比熱を計算してみよ。EX2のモンテカルロの結果と一致するか比較せよ
  \item イジング模型の転送行列に外部磁場の項を付け加え、磁場下での分配関数を計算できるように修正せよ。また、数値微分により帯磁率を求め、その温度依存性・システムサイズ依存性から、相転移の場所を見積もってみよ
  \item Nose-Hoover熱浴、Nose-Hoover Chain法以外にも、Kinetic-Moment法、Langevin法などさまざまな手法がある。それらの原理と特徴について調べよ
  \end{enumerate}

\item レポート課題

基本課題1,3,5についてレポートを作成し提出せよ(基本課題2,4,応用課題はオプションであるがこれらも解いて提出した場合には加点の対象)。実習4 (EX4)のレポート課題とあわせて、一つのレポートとして提出すること。提出締め切りは1月11日とする

\end{itemize}

\end{document}
